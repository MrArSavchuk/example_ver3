# Barrel files (реэкспорт через `index.ts`)

Этот документ описывает правило работы с импортами в проекте: **публичный API папки оформляется через `index.ts`**.

---

## Зачем это нужно

Barrel files помогают:

- сокращать и унифицировать импорты
- скрывать внутреннюю структуру папки за публичным API
- безопасно рефакторить (перемещать файлы без правок по всему проекту)
- держать архитектурные границы явными

---

## Основное правило

**Импорт из папки выполняется только через `index.ts`.**

✅ Правильно:

```ts
import { Stack } from '@/shared/ui/Stack';
import { useDebounce } from '@/shared/lib/useDebounce';
```

❌ Неправильно:

```ts
import { Stack } from '@/shared/ui/Stack/Stack';
import { useDebounce } from '@/shared/lib/useDebounce/useDebounce';
```

---

## Как устроен `index.ts`

`index.ts` — это **контракт**. Он должен экспортировать только то, что разрешено использовать снаружи.

### Пример для UI-компонента

```
shared/ui/Stack/
  Stack.tsx
  Stack.module.scss
  index.ts
```

```ts
// shared/ui/Stack/index.ts
export { Stack } from './Stack';
export type { StackProps } from './Stack';
```

### Пример для утилит/хуков

```
shared/lib/useDebounce/
  useDebounce.ts
  index.ts
```

```ts
// shared/lib/useDebounce/index.ts
export { useDebounce } from './useDebounce';
```

---

## Что можно и что нельзя экспортировать

### Можно

- публичные компоненты (`Button`, `Modal`, `Stack`)
- публичные хуки (`useDebounce`, `useOnClickOutside`)
- публичные типы (`ButtonProps`, `ModalProps`)
- константы/утилиты, которые используются в нескольких местах

### Нельзя (по умолчанию)

- приватные хелперы, предназначенные только для внутренностей папки
- внутренние компоненты (`*Internal`, `*Base`, `*Impl`) если они не часть API
- тестовые/демо сущности
- файлы со специфичной реализацией (например, `helpers`, `adapters`) без явной причины

Если есть сомнения — **лучше не экспортировать** и обсудить.

---

## Паттерны и рекомендации

### 1) Экспортируй явно, не через `export *` (предпочтительно)

✅ Предпочтительно:

```ts
export { Stack } from './Stack';
export type { StackProps } from './Stack';
```

⚠️ Допустимо, но осторожно:

```ts
export * from './Stack';
```

Почему осторожно:
- легче случайно “утечь” лишним экспортом
- могут возникать конфликты имён
- сложнее контролировать публичный API

**Рекомендация:** `export *` использовать только там, где это осознанно и безопасно.

---

### 2) Разделяй `type`-экспорт (TypeScript)

✅ Хорошо:

```ts
export { Stack } from './Stack';
export type { StackProps } from './Stack';
```

Это упрощает tree-shaking и делает намерение явнее.

---

### 3) Не делай “глобальные” индексы по всему слою без нужды

Например, индекс `shared/ui/index.ts` со всеми компонентами часто приводит к:

- размыванию границ
- тяжёлым импортам и зависимости “всё отовсюду”
- сложности контроля API

**Предпочтение:** индекс на уровне **конкретной папки компонента/модуля**.

---

### 4) Переименование и реорганизация — только внутри папки

Если нужно поменять структуру:

- можно переставлять файлы внутри папки
- можно переименовывать внутренние сущности
- **нельзя ломать внешний импорт**, если это не breaking change

Снаружи должно оставаться:

```ts
import { Stack } from '@/shared/ui/Stack';
```

---

## Частые ошибки

### Ошибка 1: обход `index.ts` “потому что быстрее”

Это создаёт “теневые зависимости” и делает рефакторинг дорогим.

### Ошибка 2: `index.ts` экспортирует всё подряд

`index.ts` — контракт. Экспортируй только то, что реально нужно снаружи.

### Ошибка 3: глубокие импорты ради типов

Типы экспортируются через `index.ts` так же, как и значения:

```ts
export type { StackProps } from './Stack';
```

---

## Когда можно нарушить правило

Исключения редкие и должны быть **осознанными**.

Допустимо, если:

- это временный техдолг и он зафиксирован задачей
- есть техническая причина (например, циклические зависимости), и она описана

В таких случаях нарушение фиксируется в `DECISIONS.md` или задачей в трекере.

---

## Чек-лист для PR

- [ ] импорты идут через `index.ts`
- [ ] новый публичный экспорт добавлен в `index.ts`
- [ ] в `index.ts` не попали приватные сущности
- [ ] структура папки не “утекла” наружу через глубокие импорты

---

## Связанные документы

- `DECISIONS.md` — решение про использование barrel files
- `CONTRIBUTING.md` — базовые правила для участников проекта
